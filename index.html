<!DOCTYPE html>
<html lang="de">
<head>

<meta charset="utf-8">

<head>

<body>


    <div id="control-bar">
      <i id="shuffle-btn" class="fa fa-random" aria-hidden="true" onclick="shuffle()"></i>
      <i id="prev-btn" class="fa fa-step-backward" aria-hidden="true" onclick="prev()"></i>
      <i id="play-btn" class="fa fa-play" aria-hidden="true" onclick="play()"></i>
      <i id="next-btn" class="fa fa-step-forward" aria-hidden="true" onclick="next()"></i>
      <i id="repeat-btn" class="fa fa-retweet" aria-hidden="true" onclick="repeat()"></i>
    </div>
    <img id="cover">
    <div id="position"></div>
    <div id="track-info"><div id="track-info-background"></div><div style="z-index: 51; position: relative;"><span id="track-title"></span><br><span id="track-artist"></span> - <span id="track-album"></span></div></div>
    <div id="seek" onclick="seek(event)" onmouseenter="displayTrackInfo()" onmousemove="getPos(event)" onmouseleave="stopTracking()">
      <div id="seek-pos">0:00</div>
    </div>
    <div id="loading"><span id="loading-text">ONE MOMENT</span><div id="longer"></div></div>
  </body>
  <script>
    var ipc = require('ipc');
    var shuffling = false;
    var repeating = false;
    var length = 0;
    var settings = {};
    setTimeout(function() {
      document.getElementById('longer').innerHTML = 'Please make sure Spotify is running and that you have an internet connection.';
    }, 10000);
    document.getElementById('cover').onload = function() {
      document.getElementById('loading').style.visibility = 'hidden';
    };
    ipc.on('coverUrl', function(url) {
      document.getElementById('cover').src = url;
      document.getElementById('track-info-background').style.backgroundImage = 'url(' + url + ')';
    });
    ipc.on('position', function(percent) {
      document.getElementById('position').setAttribute('style', 'width: ' + percent + 'vw;');
    });
    ipc.on('playing', function(playing) {
      document.getElementById('play-btn').className = 'fa fa-' + (playing ? 'pause' : 'play');
    });
    ipc.on('shuffle', function(shuffle) {
      document.getElementById('shuffle-btn').setAttribute('style', 'color: #' + (shuffle ? '23CF5F' : '6f6f6f') + ';');
      shuffling = shuffle;
    });
    ipc.on('repeat', function(repeat) {
      document.getElementById('repeat-btn').setAttribute('style', 'color: #' + (repeat ? '23CF5F' : '6f6f6f') + ';');
      repeating = repeat;
    });
    ipc.on('length', function(data) {
      length = data;
    });
    ipc.on('running', function(running) {
      if (!running) {
        document.getElementById('loading').style.visibility = 'visible';
        document.getElementById('loading-text').innerHTML = 'NO CONNECTION';
      }
    });
    ipc.on('track', function(track) {
      document.getElementById('track-title').innerHTML = track;
    });
    ipc.on('artist', function(artist) {
      document.getElementById('track-artist').innerHTML = artist;
    });
    ipc.on('album', function(album) {
      document.getElementById('track-album').innerHTML = album;
    });
    ipc.on('settings', function(settings) {
      document.getElementById('track-info').style.display = settings.showTrackTitle ? 'initial' : 'none';
    });
    function shuffle() {
      ipc.send('shuffle', !shuffling);
    }
    function repeat() {
      ipc.send('repeat', !repeating);
    }
    function play() {
      ipc.send('playpause', null);
    }
    function prev() {
      ipc.send('skip', false);
    }
    function next() {
      ipc.send('skip', true);
    }
    function seek(event) {
      var x = event.offsetX ? (event.offsetX) : event.pageX - document.getElementById('position').offsetLeft;
      var percent = (x / 400) * 100;
      document.getElementById('position').setAttribute('style', 'width: ' + percent + 'vw;');
      ipc.send('seek', percent);
    }
    function getPos(event) {
      x = event.clientX;
      y = event.clientY;
      document.getElementById('seek-pos').innerHTML = secToStamp((x / 400) * length);
      y -= 94;
      x -= 24;
      document.getElementById('seek-pos').setAttribute('style', 'top: ' + y + 'px; left: ' + x + 'px;');
    }
    function displayTrackInfo() {
      document.getElementById('track-info-background').className = '';
      document.getElementById('track-info-background').offsetWidth = document.getElementById('track-info-background').offsetWidth;
      document.getElementById('track-info-background').className = 'track-info-background-in';
      document.getElementById('track-info').className = '';
      document.getElementById('track-info').offsetWidth = document.getElementById('track-info').offsetWidth;
      document.getElementById('track-info').className = 'track-info-in';
    }
    function stopTracking() {
      document.getElementById('seek-pos').setAttribute('style', 'top: 100vh; left: 100vw;');
      document.getElementById('track-info-background').className = '';
      document.getElementById('track-info-background').offsetWidth = document.getElementById('track-info-background').offsetWidth;
      document.getElementById('track-info-background').className = 'track-info-background-out';
      document.getElementById('track-info').className = '';
      document.getElementById('track-info').offsetWidth = document.getElementById('track-info').offsetWidth;
      document.getElementById('track-info').className = 'track-info-out';
    }
    function secToStamp(sec) {
      return Math.floor(sec / 60) + ':' + (sec % 60 < 10 ? '0' : '') + Math.floor(sec % 60);
    }
  </script>
</html>

